on:
  push:
    branches:
    - main
    
jobs:
  setup:
    name: Create environment
    runs-on: ubuntu-latest
    environment: production
    strategy:
      matrix:
        node-version: [10.x]
    steps:
    - run: |
       git config --global user.email "me@joelsanden.se"
       git config --global user.name "Joel Sand√©n"
  install:
    runs-on: ubuntu-latest
    environment: production
    name: Installing packages
    steps:
    - name: Checkout master
      uses: actions/checkout@master
    - name: Run yarn
      run: yarn
    - name: Release new version
      run: yarn release
    - name: Commit new version
      run: git push --follow-tags origin main
  prerelease:
    runs-on: ubuntu-latest
    environment: production
    name: Updating release related files
    steps:
    - name: Release new version
      run: yarn release
    - name: Commit new version
      run: git push --follow-tags origin main
